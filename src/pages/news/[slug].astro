---
import api from "@/api";
import Markdown from "@/components/Markdown.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import type { NewsItem } from "@/types";

let article:NewsItem | undefined;

const {slug} = Astro.params;
try {
  article = await api.getNewsBySlug(slug as string);
} catch (error) {
  console.error(error);
  return Astro.redirect('/404');
}

if (!article) {
  return Astro.redirect('/404');
}

const title = article?.attributes?.title ?? 'WOW TV EL SALVADOR';
const heroImageUrl = article?.attributes.hero_image?.data?.attributes?.formats?.large?.url 
  ?? article?.attributes.hero_image?.data?.attributes?.formats?.medium?.url
  ?? article?.attributes.hero_image?.data?.attributes?.formats?.small?.url
  ?? article?.attributes.hero_image?.data?.attributes?.formats?.thumbnail?.url;
const content = (article?.attributes?.content ?? '');
---

<MainLayout title={title}>
    <div class="flex max-w-[1280px] mx-auto px-5">
      <a href="/news">
        <button class="btn btn-outline">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" stroke="currentColor" viewBox="0 0 24 24" style="fill: rgba(0, 0, 0, 1);transform: ;msFilter:;"><path d="M21 11H6.414l5.293-5.293-1.414-1.414L2.586 12l7.707 7.707 1.414-1.414L6.414 13H21z"></path></svg>
        Volver atr√°s
        </button>
      </a>
    </div>
    <section class="flex flex-col items-center max-w-[1280px] mx-auto">
        <h2 class="max-w-[900px] text-center text-pretty font-bold text-4xl p-5">{title}</h2>
        <img class="max-h-[500px] rounded-2xl p-5" src={heroImageUrl} alt={title} />
        <Markdown content={content} />
    </section>
</MainLayout>
